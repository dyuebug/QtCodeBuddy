# 第3章：布局管理

## 一、本章概述

### 1.1 学习目标

- 掌握四种布局管理器的使用
- 理解布局嵌套和拉伸因子
- 学会动态添加/移除控件

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| QVBoxLayout | ★★★★★ | 垂直布局 |
| QHBoxLayout | ★★★★★ | 水平布局 |
| QGridLayout | ★★★★☆ | 网格布局 |
| QFormLayout | ★★★★☆ | 表单布局 |

---

## 二、为什么需要布局管理？

### 2.1 不使用布局的问题

```cpp
// 手动设置位置（不推荐）
QPushButton *btn1 = new QPushButton("按钮1", this);
btn1->setGeometry(10, 10, 80, 30);

QPushButton *btn2 = new QPushButton("按钮2", this);
btn2->setGeometry(10, 50, 80, 30);
```

**问题**：
- 窗口大小改变时，控件位置不会自动调整
- 需要手动计算每个控件的位置
- 维护困难

### 2.2 使用布局的优势

- 自动调整控件大小和位置
- 窗口缩放时自动适应
- 代码简洁，易于维护

---

## 三、QVBoxLayout - 垂直布局

### 3.1 是什么？

将控件**从上到下**依次排列的布局管理器。

### 3.2 怎么用？

```cpp
#include <QVBoxLayout>

QVBoxLayout *layout = new QVBoxLayout(this);

// 添加控件
layout->addWidget(new QPushButton("按钮1"));
layout->addWidget(new QPushButton("按钮2"));
layout->addWidget(new QPushButton("按钮3"));

// 设置间距
layout->setSpacing(10);  // 控件之间的间距

// 设置边距
layout->setContentsMargins(20, 20, 20, 20);  // 左、上、右、下
```

### 3.3 添加弹簧（Stretch）

```cpp
layout->addWidget(new QPushButton("顶部按钮"));
layout->addStretch();  // 弹簧，将后面的控件推到底部
layout->addWidget(new QPushButton("底部按钮"));
```

**效果**：顶部按钮在上方，底部按钮被推到最下方。

---

## 四、QHBoxLayout - 水平布局

### 4.1 是什么？

将控件**从左到右**依次排列的布局管理器。

### 4.2 怎么用？

```cpp
#include <QHBoxLayout>

QHBoxLayout *layout = new QHBoxLayout(this);

layout->addWidget(new QPushButton("左"));
layout->addWidget(new QPushButton("中"));
layout->addWidget(new QPushButton("右"));
layout->addStretch();  // 将按钮推向左侧
```

---

## 五、QGridLayout - 网格布局

### 5.1 是什么？

将控件按**行列网格**排列的布局管理器。

### 5.2 怎么用？

```cpp
#include <QGridLayout>

QGridLayout *layout = new QGridLayout(this);

// addWidget(控件, 行, 列)
layout->addWidget(new QPushButton("(0,0)"), 0, 0);
layout->addWidget(new QPushButton("(0,1)"), 0, 1);
layout->addWidget(new QPushButton("(1,0)"), 1, 0);
layout->addWidget(new QPushButton("(1,1)"), 1, 1);
```

### 5.3 跨行跨列

```cpp
// addWidget(控件, 行, 列, 跨行数, 跨列数)
layout->addWidget(new QPushButton("跨2列"), 2, 0, 1, 2);
layout->addWidget(new QPushButton("跨2行"), 0, 2, 2, 1);
```

### 5.4 设置拉伸因子

```cpp
layout->setColumnStretch(0, 1);  // 第0列拉伸因子为1
layout->setColumnStretch(1, 2);  // 第1列拉伸因子为2（占更多空间）
layout->setRowStretch(0, 1);
```

---

## 六、QFormLayout - 表单布局

### 6.1 是什么？

专门用于**表单界面**的布局，自动管理标签和输入框的配对。

### 6.2 怎么用？

```cpp
#include <QFormLayout>

QFormLayout *layout = new QFormLayout(this);

layout->addRow("姓名:", new QLineEdit());
layout->addRow("年龄:", new QSpinBox());
layout->addRow("邮箱:", new QLineEdit());

// 设置标签对齐
layout->setLabelAlignment(Qt::AlignRight);
```

---

## 七、布局嵌套

### 7.1 为什么需要嵌套？

复杂界面需要组合多种布局才能实现。

### 7.2 怎么嵌套？

```cpp
// 主布局（水平）
QHBoxLayout *mainLayout = new QHBoxLayout(this);

// 左侧子布局（垂直）
QVBoxLayout *leftLayout = new QVBoxLayout();
leftLayout->addWidget(new QPushButton("按钮1"));
leftLayout->addWidget(new QPushButton("按钮2"));

// 右侧子布局（网格）
QGridLayout *rightLayout = new QGridLayout();
rightLayout->addWidget(new QLabel("姓名:"), 0, 0);
rightLayout->addWidget(new QLineEdit(), 0, 1);

// 添加子布局到主布局
mainLayout->addLayout(leftLayout, 1);  // 拉伸因子1
mainLayout->addLayout(rightLayout, 2); // 拉伸因子2
```

---

## 八、动态布局操作

### 8.1 动态添加控件

```cpp
void MyWidget::addButton()
{
    QPushButton *btn = new QPushButton("新按钮");
    m_layout->addWidget(btn);
}
```

### 8.2 动态移除控件

```cpp
void MyWidget::removeButton()
{
    QLayoutItem *item = m_layout->takeAt(0);
    if (item && item->widget()) {
        delete item->widget();
    }
    delete item;
}
```

---

## 九、本章小结

| 布局类型 | 排列方式 | 适用场景 |
|----------|----------|----------|
| QVBoxLayout | 垂直 | 工具栏、列表 |
| QHBoxLayout | 水平 | 按钮组、导航栏 |
| QGridLayout | 网格 | 计算器、表格 |
| QFormLayout | 表单 | 设置页、注册表单 |

---

## 十、练习题

1. 创建一个计算器界面（4x4 网格布局）
2. 实现动态添加/删除按钮的功能
