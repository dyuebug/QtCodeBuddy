# 第2章：窗口和部件

## 一、本章概述

### 1.1 学习目标

- 掌握 Qt 中常用控件的使用方法
- 理解控件的属性设置和样式定制
- 学会窗口属性的配置（模态、大小、位置等）

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| 按钮类控件 | ★★★★★ | QPushButton、QCheckBox、QRadioButton |
| 输入类控件 | ★★★★★ | QLineEdit、QTextEdit、QSpinBox |
| 显示类控件 | ★★★★☆ | QLabel、QProgressBar、QLCDNumber |
| 窗口属性 | ★★★★☆ | 模态性、大小、位置 |

---

## 二、按钮类控件

### 2.1 QPushButton - 普通按钮

#### 是什么？
最常用的按钮控件，用户点击后触发操作。

#### 为什么用它？
- 触发动作（保存、提交、取消等）
- 可以显示文本和图标
- 支持快捷键

#### 怎么用？

```cpp
#include <QPushButton>

// 创建按钮
QPushButton *btn = new QPushButton("确定", this);

// 设置属性
btn->setText("点击我");           // 设置文本
btn->setEnabled(true);            // 启用/禁用
btn->setToolTip("这是提示信息");  // 鼠标悬停提示
btn->setShortcut(QKeySequence("Ctrl+S")); // 快捷键

// 连接信号
connect(btn, &QPushButton::clicked, this, &MyWidget::onBtnClicked);
```

#### 常用信号

| 信号 | 触发时机 |
|------|----------|
| `clicked()` | 按钮被点击 |
| `pressed()` | 按钮被按下 |
| `released()` | 按钮被释放 |

---

### 2.2 QCheckBox - 复选框

#### 是什么？
允许用户选择或取消选择的控件，可多选。

#### 怎么用？

```cpp
#include <QCheckBox>

QCheckBox *checkbox = new QCheckBox("启用功能", this);

// 设置状态
checkbox->setChecked(true);       // 选中
checkbox->setTristate(true);      // 启用三态（选中/未选中/部分选中）

// 获取状态
bool isChecked = checkbox->isChecked();
Qt::CheckState state = checkbox->checkState();

// 连接信号
connect(checkbox, &QCheckBox::checkStateChanged,
        [](Qt::CheckState state) {
    if (state == Qt::Checked) {
        // 已选中
    } else if (state == Qt::Unchecked) {
        // 未选中
    }
});
```

---

### 2.3 QRadioButton - 单选按钮

#### 是什么？
一组互斥的选项，同一组内只能选择一个。

#### 怎么用？

```cpp
#include <QRadioButton>
#include <QGroupBox>

// 创建分组框（同一组内的单选按钮互斥）
QGroupBox *group = new QGroupBox("选择性别", this);
QVBoxLayout *layout = new QVBoxLayout(group);

QRadioButton *male = new QRadioButton("男", group);
QRadioButton *female = new QRadioButton("女", group);

male->setChecked(true);  // 默认选中

layout->addWidget(male);
layout->addWidget(female);

// 连接信号
connect(male, &QRadioButton::toggled, [](bool checked) {
    if (checked) {
        // 男被选中
    }
});
```

**重要**：同一个父控件下的 QRadioButton 自动互斥。如需多组，使用 QGroupBox 或 QButtonGroup 分组。

---

## 三、输入类控件

### 3.1 QLineEdit - 单行文本输入

#### 是什么？
单行文本输入框，用于输入用户名、密码等。

#### 怎么用？

```cpp
#include <QLineEdit>

QLineEdit *edit = new QLineEdit(this);

// 基本设置
edit->setText("默认文本");
edit->setPlaceholderText("请输入用户名...");  // 占位提示
edit->setMaxLength(20);                        // 最大长度

// 密码模式
edit->setEchoMode(QLineEdit::Password);

// 只读模式
edit->setReadOnly(true);

// 获取文本
QString text = edit->text();

// 常用信号
connect(edit, &QLineEdit::textChanged, [](const QString &text) {
    // 文本改变时触发
});

connect(edit, &QLineEdit::returnPressed, []() {
    // 按下回车时触发
});
```

#### EchoMode 模式

| 模式 | 效果 |
|------|------|
| `Normal` | 正常显示 |
| `Password` | 显示圆点 |
| `NoEcho` | 不显示任何内容 |
| `PasswordEchoOnEdit` | 编辑时显示，失焦后隐藏 |

---

### 3.2 QTextEdit - 多行文本输入

#### 是什么？
多行富文本编辑器，支持格式化文本。

#### 怎么用？

```cpp
#include <QTextEdit>

QTextEdit *textEdit = new QTextEdit(this);

// 设置文本
textEdit->setPlainText("纯文本内容");
textEdit->setHtml("<b>粗体</b>和<i>斜体</i>");

// 获取文本
QString plain = textEdit->toPlainText();
QString html = textEdit->toHtml();

// 设置只读
textEdit->setReadOnly(true);

// 限制高度
textEdit->setMaximumHeight(100);
```

---

### 3.3 QSpinBox - 整数选择器

#### 是什么？
带上下箭头的整数输入框。

#### 怎么用？

```cpp
#include <QSpinBox>

QSpinBox *spinBox = new QSpinBox(this);

spinBox->setRange(0, 100);    // 设置范围
spinBox->setValue(50);        // 设置当前值
spinBox->setSingleStep(5);    // 步进值
spinBox->setSuffix(" 个");    // 后缀
spinBox->setPrefix("数量: "); // 前缀

// 获取值
int value = spinBox->value();

// 信号
connect(spinBox, QOverload<int>::of(&QSpinBox::valueChanged),
        [](int value) {
    // 值改变时触发
});
```

---

### 3.4 QComboBox - 下拉选择框

#### 是什么？
下拉列表，用于从多个选项中选择一个。

#### 怎么用？

```cpp
#include <QComboBox>

QComboBox *combo = new QComboBox(this);

// 添加选项
combo->addItem("苹果");
combo->addItem("香蕉");
combo->addItems({"橘子", "葡萄", "西瓜"});

// 设置当前选项
combo->setCurrentIndex(0);
combo->setCurrentText("香蕉");

// 获取选项
int index = combo->currentIndex();
QString text = combo->currentText();

// 信号
connect(combo, QOverload<int>::of(&QComboBox::currentIndexChanged),
        [](int index) {
    // 选项改变时触发
});
```

---

### 3.5 QSlider - 滑动条

#### 是什么？
通过拖动滑块选择数值的控件。

#### 怎么用？

```cpp
#include <QSlider>

QSlider *slider = new QSlider(Qt::Horizontal, this);

slider->setRange(0, 100);
slider->setValue(50);
slider->setTickPosition(QSlider::TicksBelow);  // 显示刻度
slider->setTickInterval(10);                    // 刻度间隔

connect(slider, &QSlider::valueChanged, [](int value) {
    // 值改变时触发
});
```

---

## 四、显示类控件

### 4.1 QLabel - 标签

#### 是什么？
用于显示文本或图片的控件。

#### 怎么用？

```cpp
#include <QLabel>

QLabel *label = new QLabel("Hello Qt!", this);

// 文本设置
label->setText("新文本");
label->setAlignment(Qt::AlignCenter);  // 居中对齐
label->setWordWrap(true);              // 自动换行

// 显示图片
label->setPixmap(QPixmap(":/images/logo.png"));
label->setScaledContents(true);        // 缩放图片适应标签

// 样式
label->setStyleSheet("font-size: 16px; color: blue;");
```

---

### 4.2 QProgressBar - 进度条

#### 是什么？
显示任务进度的控件。

#### 怎么用？

```cpp
#include <QProgressBar>

QProgressBar *progress = new QProgressBar(this);

progress->setRange(0, 100);
progress->setValue(30);
progress->setFormat("%p%");  // 显示百分比

// 不确定进度（循环动画）
progress->setRange(0, 0);
```

---

### 4.3 QLCDNumber - LCD 数字显示

#### 是什么？
模拟 LCD 显示屏的数字显示控件。

#### 怎么用？

```cpp
#include <QLCDNumber>

QLCDNumber *lcd = new QLCDNumber(this);

lcd->setDigitCount(5);                    // 显示位数
lcd->display(12345);                      // 显示数字
lcd->setSegmentStyle(QLCDNumber::Flat);   // 显示风格
```

---

## 五、窗口属性

### 5.1 模态窗口 vs 非模态窗口

#### 模态窗口
打开后**阻塞**父窗口，必须关闭后才能操作父窗口。

```cpp
QDialog *dialog = new QDialog(this);
dialog->setWindowModality(Qt::ApplicationModal);
dialog->exec();  // 阻塞式显示
```

#### 非模态窗口
打开后**不阻塞**父窗口，可同时操作。

```cpp
QWidget *window = new QWidget();
window->setAttribute(Qt::WA_DeleteOnClose);
window->show();  // 非阻塞式显示
```

---

### 5.2 窗口大小和位置

```cpp
// 设置大小
window->resize(800, 600);
window->setFixedSize(400, 300);      // 固定大小
window->setMinimumSize(200, 150);    // 最小尺寸
window->setMaximumSize(1200, 900);   // 最大尺寸

// 设置位置
window->move(100, 100);

// 窗口居中
QScreen *screen = QApplication::primaryScreen();
QRect screenGeometry = screen->availableGeometry();
int x = (screenGeometry.width() - window->width()) / 2;
int y = (screenGeometry.height() - window->height()) / 2;
window->move(x, y);
```

---

## 六、本章小结

| 控件类型 | 常用控件 | 主要用途 |
|----------|----------|----------|
| 按钮类 | QPushButton, QCheckBox, QRadioButton | 触发操作、选择 |
| 输入类 | QLineEdit, QTextEdit, QSpinBox, QComboBox | 用户输入 |
| 显示类 | QLabel, QProgressBar, QLCDNumber | 信息展示 |

---

## 七、练习题

1. 创建一个登录窗口，包含用户名输入框、密码输入框和登录按钮
2. 添加"记住密码"复选框
3. 点击登录按钮后，显示输入的用户名
