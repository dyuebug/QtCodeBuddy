# 第12章：模型视图

## 一、本章概述

### 1.1 学习目标

- 理解 Model/View 架构设计思想
- 掌握 QStringListModel 字符串列表模型
- 掌握 QStandardItemModel 标准项模型
- 学会使用 QListView 和 QTableView

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| Model/View 架构 | ★★★★★ | 数据与视图分离 |
| QStringListModel | ★★★★☆ | 字符串列表模型 |
| QStandardItemModel | ★★★★★ | 通用标准项模型 |
| QListView | ★★★★☆ | 列表视图 |
| QTableView | ★★★★★ | 表格视图 |

---

## 二、Model/View 架构

### 2.1 架构概述

```
┌─────────┐    ┌─────────┐    ┌─────────┐
│  Model  │◄──►│  View   │◄──►│Delegate │
│  数据层  │    │  视图层  │    │  委托层  │
└─────────┘    └─────────┘    └─────────┘
```

- **Model**：负责数据存储和访问
- **View**：负责数据展示
- **Delegate**：负责数据编辑和渲染

### 2.2 优势

- 数据与显示分离，便于维护
- 同一数据可用多种视图展示
- 支持大数据量的高效显示

---

## 三、QStringListModel

### 3.1 基本用法

```cpp
// 创建模型
QStringListModel *model = new QStringListModel(this);

// 设置数据
QStringList items = {"项目 1", "项目 2", "项目 3"};
model->setStringList(items);

// 绑定到视图
QListView *listView = new QListView(this);
listView->setModel(model);
```

### 3.2 数据操作

```cpp
// 添加项
int row = model->rowCount();
model->insertRow(row);
model->setData(model->index(row), "新项目");

// 删除项
QModelIndex index = listView->currentIndex();
if (index.isValid()) {
    model->removeRow(index.row());
}

// 获取所有数据
QStringList allItems = model->stringList();
```

---

## 四、QStandardItemModel

### 4.1 创建表格模型

```cpp
// 创建 3行3列 的模型
QStandardItemModel *model = new QStandardItemModel(3, 3, this);

// 设置表头
model->setHorizontalHeaderLabels({"姓名", "年龄", "城市"});

// 设置数据
model->setItem(0, 0, new QStandardItem("张三"));
model->setItem(0, 1, new QStandardItem("25"));
model->setItem(0, 2, new QStandardItem("北京"));
```

### 4.2 绑定到 QTableView

```cpp
QTableView *tableView = new QTableView(this);
tableView->setModel(model);

// 最后一列自动拉伸
tableView->horizontalHeader()->setStretchLastSection(true);
```

### 4.3 行操作

```cpp
// 添加行
int row = model->rowCount();
model->insertRow(row);
model->setItem(row, 0, new QStandardItem("新用户"));
model->setItem(row, 1, new QStandardItem("0"));
model->setItem(row, 2, new QStandardItem("未知"));

// 删除行
QModelIndex index = tableView->currentIndex();
if (index.isValid()) {
    model->removeRow(index.row());
}
```

---

## 五、视图配置

### 5.1 编辑触发方式

```cpp
// 双击编辑
listView->setEditTriggers(QAbstractItemView::DoubleClicked);

// 单击编辑
listView->setEditTriggers(QAbstractItemView::CurrentChanged);

// 禁止编辑
listView->setEditTriggers(QAbstractItemView::NoEditTriggers);
```

### 5.2 选择模式

```cpp
// 单选
tableView->setSelectionMode(QAbstractItemView::SingleSelection);

// 多选
tableView->setSelectionMode(QAbstractItemView::MultiSelection);

// 扩展选择（Ctrl/Shift）
tableView->setSelectionMode(QAbstractItemView::ExtendedSelection);
```

---

## 六、本章小结

| 类 | 用途 |
|------|------|
| QStringListModel | 字符串列表数据模型 |
| QStandardItemModel | 通用标准项模型 |
| QListView | 列表形式展示数据 |
| QTableView | 表格形式展示数据 |
| QModelIndex | 模型索引，定位数据项 |

| 方法 | 用途 |
|------|------|
| setModel() | 视图绑定模型 |
| insertRow() | 插入行 |
| removeRow() | 删除行 |
| setData() | 设置数据 |
| setItem() | 设置项（QStandardItemModel） |
