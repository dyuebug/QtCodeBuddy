# 第1章：Qt6 基础入门

## 一、本章概述

### 1.1 学习目标

- 理解 Qt 应用程序的基本结构
- 掌握 QApplication 和 QWidget 的作用
- 理解事件循环的概念
- 能够创建第一个 Qt 窗口程序

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| QApplication | ★★★★★ | 应用程序的核心管理类 |
| QWidget | ★★★★★ | 所有界面元素的基类 |
| 事件循环 | ★★★★☆ | Qt 程序运行的核心机制 |
| Q_OBJECT 宏 | ★★★★☆ | 启用信号槽机制的必要条件 |

---

## 二、核心概念详解

### 2.1 QApplication - 应用程序管理器

#### 是什么？

`QApplication` 是 Qt GUI 应用程序的**核心管理类**。每个 Qt 桌面应用程序**必须且只能有一个** QApplication 对象。

#### 为什么需要它？

QApplication 负责以下关键任务：

1. **初始化 Qt 环境**：设置字体、调色板、样式等
2. **处理命令行参数**：解析 `-style`、`-geometry` 等参数
3. **管理事件循环**：分发鼠标、键盘等事件到对应窗口
4. **管理应用程序级设置**：应用名称、版本、组织信息等

#### 怎么用？

```cpp
#include <QApplication>

int main(int argc, char *argv[])
{
    // 1. 创建 QApplication 对象（必须在最前面）
    QApplication app(argc, argv);

    // 2. 设置应用程序信息（可选但推荐）
    app.setApplicationName("我的应用");
    app.setApplicationVersion("1.0.0");
    app.setOrganizationName("我的公司");

    // 3. 创建窗口并显示
    // ... 窗口代码 ...

    // 4. 启动事件循环
    return app.exec();
}
```

#### 常用方法

| 方法 | 作用 | 示例 |
|------|------|------|
| `setApplicationName()` | 设置应用名称 | `app.setApplicationName("NotepadPro")` |
| `setApplicationVersion()` | 设置版本号 | `app.setApplicationVersion("1.0.0")` |
| `setOrganizationName()` | 设置组织名称 | `app.setOrganizationName("MyCompany")` |
| `setStyle()` | 设置界面风格 | `app.setStyle("Fusion")` |
| `exec()` | 启动事件循环 | `return app.exec()` |
| `quit()` | 退出应用程序 | `QApplication::quit()` |

---

### 2.2 QWidget - 界面元素基类

#### 是什么？

`QWidget` 是 Qt 中**所有用户界面对象的基类**。按钮、标签、输入框等控件都继承自 QWidget。

#### 为什么重要？

- 它是构建 UI 的基础积木
- 没有父窗口的 QWidget 就是一个独立窗口
- 有父窗口的 QWidget 是子控件

#### 窗口 vs 控件

```
┌─────────────────────────────────────┐
│  QWidget (parent = nullptr)         │  ← 这是一个窗口
│  ┌─────────────────────────────┐    │
│  │  QLabel (parent = this)     │    │  ← 这是窗口内的控件
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │  QPushButton (parent = this)│    │  ← 这也是控件
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

#### 怎么用？

```cpp
#include <QWidget>
#include <QLabel>
#include <QPushButton>

// 方式1：直接使用 QWidget 作为窗口
QWidget *window = new QWidget();
window->setWindowTitle("我的窗口");
window->resize(400, 300);
window->show();

// 方式2：继承 QWidget 创建自定义窗口类
class MyWindow : public QWidget
{
    Q_OBJECT  // 必须添加这个宏！
public:
    MyWindow(QWidget *parent = nullptr) : QWidget(parent)
    {
        setWindowTitle("自定义窗口");
        resize(400, 300);
    }
};
```

#### 常用方法

| 方法 | 作用 | 示例 |
|------|------|------|
| `show()` | 显示窗口 | `window->show()` |
| `hide()` | 隐藏窗口 | `window->hide()` |
| `close()` | 关闭窗口 | `window->close()` |
| `resize()` | 设置大小 | `window->resize(800, 600)` |
| `move()` | 设置位置 | `window->move(100, 100)` |
| `setWindowTitle()` | 设置标题 | `window->setWindowTitle("标题")` |
| `setMinimumSize()` | 设置最小尺寸 | `window->setMinimumSize(400, 300)` |

---

### 2.3 事件循环 - Qt 程序的心脏

#### 是什么？

事件循环是一个**无限循环**，不断地：
1. 等待事件（鼠标点击、键盘输入、定时器等）
2. 将事件分发给对应的窗口/控件处理
3. 重复以上过程

#### 为什么需要它？

没有事件循环，程序会立即退出：

```cpp
int main(int argc, char *argv[])
{
    QApplication app(argc, argv);
    QWidget window;
    window.show();
    // 如果没有 app.exec()，程序会立即结束！
    return app.exec();  // 这里开始事件循环
}
```

#### 事件循环流程图

```
程序启动
    │
    ▼
app.exec() 开始
    │
    ▼
┌─────────────────┐
│   等待事件      │◄─────────────┐
└────────┬────────┘              │
         │                       │
         ▼                       │
┌─────────────────┐              │
│   获取事件      │              │
└────────┬────────┘              │
         │                       │
         ▼                       │
┌─────────────────┐              │
│   分发到窗口    │              │
└────────┬────────┘              │
         │                       │
         ▼                       │
┌─────────────────┐              │
│   处理事件      │──────────────┘
└────────┬────────┘
         │
         ▼ (调用 quit() 或关闭最后一个窗口)
    程序退出
```

---

### 2.4 Q_OBJECT 宏

#### 是什么？

`Q_OBJECT` 是一个**预处理宏**，必须放在类定义的私有区域。

#### 为什么需要它？

它告诉 Qt 的元对象编译器（moc）为这个类生成额外的代码，以支持：
- 信号和槽机制
- 运行时类型信息
- 动态属性系统

#### 怎么用？

```cpp
class MyWidget : public QWidget
{
    Q_OBJECT  // 必须在类的开头，private 区域

public:
    explicit MyWidget(QWidget *parent = nullptr);

signals:
    void mySignal();  // 自定义信号

private slots:
    void mySlot();    // 自定义槽
};
```

**注意**：如果忘记添加 Q_OBJECT，信号和槽将无法工作！

---

## 三、示例代码讲解

### 3.1 main.cpp - 程序入口

```cpp
#include <QApplication>
#include "HelloWorld.h"

int main(int argc, char *argv[])
{
    // 步骤1：创建应用程序对象
    // argc 和 argv 是命令行参数，Qt 会解析其中的特殊参数
    QApplication app(argc, argv);

    // 步骤2：设置应用程序信息
    // 这些信息会被 QSettings 等类使用
    app.setApplicationName("Qt6基础教程");
    app.setOrganizationName("MyCompany");
    app.setApplicationVersion("1.0.0");

    // 步骤3：创建主窗口
    // 在栈上创建，程序结束时自动销毁
    HelloWorld window;

    // 步骤4：显示窗口
    // 窗口默认是隐藏的，必须调用 show()
    window.show();

    // 步骤5：进入事件循环
    // exec() 会阻塞，直到程序退出
    return app.exec();
}
```

### 3.2 HelloWorld.h - 窗口类声明

```cpp
#ifndef HELLOWORLD_H
#define HELLOWORLD_H

#include <QWidget>
#include <QLabel>
#include <QPushButton>
#include <QVBoxLayout>

class HelloWorld : public QWidget
{
    Q_OBJECT  // 启用信号槽机制

public:
    // explicit 防止隐式类型转换
    // parent 默认为 nullptr，表示这是顶层窗口
    explicit HelloWorld(QWidget *parent = nullptr);

private:
    void setupUi();       // 初始化界面
    void connectSignals(); // 连接信号和槽

private slots:
    void onButtonClicked(); // 按钮点击的槽函数

private:
    QLabel *m_label;        // 标签控件
    QPushButton *m_button;  // 按钮控件
    QVBoxLayout *m_layout;  // 布局管理器
};

#endif // HELLOWORLD_H
```

### 3.3 HelloWorld.cpp - 窗口类实现

```cpp
#include "HelloWorld.h"
#include <QMessageBox>

HelloWorld::HelloWorld(QWidget *parent)
    : QWidget(parent)      // 调用基类构造函数
    , m_label(nullptr)     // 初始化成员指针
    , m_button(nullptr)
    , m_layout(nullptr)
{
    setupUi();
    connectSignals();

    // 设置窗口属性
    setWindowTitle("第1章：Qt6基础入门 - Hello World");
    resize(400, 300);
}

void HelloWorld::setupUi()
{
    // 创建标签
    m_label = new QLabel("欢迎使用Qt6！", this);
    m_label->setAlignment(Qt::AlignCenter);

    // 创建按钮
    m_button = new QPushButton("点击我", this);

    // 创建布局并添加控件
    m_layout = new QVBoxLayout(this);
    m_layout->addWidget(m_label);
    m_layout->addWidget(m_button);
    m_layout->setSpacing(20);
    m_layout->setContentsMargins(30, 30, 30, 30);
}

void HelloWorld::connectSignals()
{
    // 连接按钮的 clicked 信号到槽函数
    connect(m_button, &QPushButton::clicked,
            this, &HelloWorld::onButtonClicked);
}

void HelloWorld::onButtonClicked()
{
    static int clickCount = 0;
    clickCount++;

    // 更新标签文本
    m_label->setText(QString("你已点击按钮 %1 次！").arg(clickCount));

    // 显示消息框
    if (clickCount == 1) {
        QMessageBox::information(this, "提示",
            "这是第一次点击！\nQt6的信号和槽机制工作正常！");
    }
}
```

---

## 四、知识扩展

### 4.1 Qt 应用程序类型

| 类 | 用途 | 头文件 |
|----|------|--------|
| QApplication | GUI 应用程序 | `<QApplication>` |
| QGuiApplication | 无控件的 GUI 应用（如 QML） | `<QGuiApplication>` |
| QCoreApplication | 控制台应用程序 | `<QCoreApplication>` |

### 4.2 窗口标志（Window Flags）

```cpp
// 设置窗口类型
setWindowFlags(Qt::Window);           // 普通窗口
setWindowFlags(Qt::Dialog);           // 对话框
setWindowFlags(Qt::Tool);             // 工具窗口
setWindowFlags(Qt::FramelessWindowHint); // 无边框窗口

// 组合使用
setWindowFlags(Qt::Window | Qt::WindowStaysOnTopHint); // 置顶窗口
```

### 4.3 常用样式表

```cpp
// 设置标签样式
m_label->setStyleSheet(
    "font-size: 18px;"
    "font-weight: bold;"
    "color: #333;"
);

// 设置按钮样式
m_button->setStyleSheet(
    "QPushButton {"
    "    background-color: #4a90e2;"
    "    color: white;"
    "    border-radius: 5px;"
    "    padding: 10px 20px;"
    "}"
    "QPushButton:hover {"
    "    background-color: #357abd;"
    "}"
);
```

---

## 五、常见问题

### Q1: 为什么窗口一闪而过？

**原因**：没有调用 `app.exec()` 进入事件循环。

**解决**：确保 main 函数最后返回 `app.exec()`。

### Q2: 信号和槽不工作？

**原因**：忘记添加 `Q_OBJECT` 宏。

**解决**：在类定义开头添加 `Q_OBJECT`，然后重新运行 qmake/cmake。

### Q3: 中文显示乱码？

**原因**：源文件编码不是 UTF-8。

**解决**：将源文件保存为 UTF-8 编码。

---

## 六、本章小结

| 知识点 | 要点 |
|--------|------|
| QApplication | 每个程序必须有且只有一个 |
| QWidget | 所有 UI 元素的基类 |
| 事件循环 | `app.exec()` 启动，`quit()` 退出 |
| Q_OBJECT | 使用信号槽必须添加 |
| show() | 窗口默认隐藏，需要手动显示 |

---

## 七、练习题

1. 创建一个窗口，标题为"我的第一个Qt程序"，大小为 600x400
2. 在窗口中添加一个标签，显示当前时间
3. 添加一个按钮，点击后更新时间显示

**提示**：使用 `QDateTime::currentDateTime().toString()` 获取当前时间。
