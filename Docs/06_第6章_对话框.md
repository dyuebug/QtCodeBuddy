# 第6章：对话框

## 一、本章概述

### 1.1 学习目标

- 掌握标准对话框的使用
- 学会创建自定义对话框
- 理解模态与非模态的区别

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| QMessageBox | ★★★★★ | 消息提示框 |
| QFileDialog | ★★★★★ | 文件选择框 |
| QInputDialog | ★★★★☆ | 输入对话框 |
| QProgressDialog | ★★★★☆ | 进度对话框 |
| 自定义对话框 | ★★★★☆ | 继承 QDialog |
| 模态性 | ★★★☆☆ | 模态与非模态 |

---

## 二、QMessageBox - 消息对话框

### 2.1 信息提示

```cpp
QMessageBox::information(this, "标题", "这是一条信息");
```

### 2.2 询问对话框

```cpp
QMessageBox::StandardButton reply = QMessageBox::question(
    this, "确认", "是否继续？",
    QMessageBox::Yes | QMessageBox::No
);

if (reply == QMessageBox::Yes) {
    // 用户点击了是
}
```

### 2.3 警告和错误

```cpp
QMessageBox::warning(this, "警告", "操作可能有风险");
QMessageBox::critical(this, "错误", "发生严重错误");
```

---

## 三、QFileDialog - 文件对话框

### 3.1 打开文件

```cpp
QString fileName = QFileDialog::getOpenFileName(
    this, "打开文件", "",
    "文本文件 (*.txt);;所有文件 (*.*)"
);
```

### 3.2 保存文件

```cpp
QString fileName = QFileDialog::getSaveFileName(
    this, "保存文件", "", "文本文件 (*.txt)"
);
```

### 3.3 选择目录

```cpp
QString dir = QFileDialog::getExistingDirectory(this, "选择目录");
```

---

## 四、QInputDialog - 输入对话框

```cpp
bool ok;
QString text = QInputDialog::getText(this, "输入", "请输入名字:",
    QLineEdit::Normal, "", &ok);

int value = QInputDialog::getInt(this, "输入", "请输入数字:",
    0, -100, 100, 1, &ok);
```

---

## 五、QProgressDialog - 进度对话框

```cpp
QProgressDialog progress("正在处理...", "取消", 0, 100, this);
progress.setWindowModality(Qt::WindowModal);
progress.setWindowTitle("进度");

for (int i = 0; i <= 100; i++) {
    progress.setValue(i);

    if (progress.wasCanceled()) {
        break;  // 用户点击取消
    }

    QThread::msleep(50);  // 模拟耗时操作
}
```

---

## 六、自定义对话框

```cpp
class MyDialog : public QDialog
{
    Q_OBJECT
public:
    MyDialog(QWidget *parent = nullptr);
    QString username() const { return m_edit->text(); }
private:
    QLineEdit *m_edit;
};
```

---

## 七、模态与非模态

### 7.1 模态对话框

```cpp
// 模态对话框 - 阻塞父窗口
CustomDialog dialog(this);
if (dialog.exec() == QDialog::Accepted) {
    // 用户点击确定
}
```

### 7.2 非模态对话框

```cpp
// 非模态对话框 - 不阻塞父窗口
CustomDialog *dialog = new CustomDialog(this);
dialog->setAttribute(Qt::WA_DeleteOnClose);  // 关闭时自动删除
dialog->show();  // 非模态显示
```

### 7.3 窗口模态

```cpp
// 设置窗口模态级别
dialog->setWindowModality(Qt::NonModal);        // 非模态
dialog->setWindowModality(Qt::WindowModal);     // 窗口模态
dialog->setWindowModality(Qt::ApplicationModal); // 应用程序模态
```

---

## 八、本章小结

| 对话框类型 | 用途 |
|------------|------|
| QMessageBox | 消息提示 |
| QFileDialog | 文件选择 |
| QInputDialog | 简单输入 |
| QProgressDialog | 进度显示 |
| QColorDialog | 颜色选择 |
| QFontDialog | 字体选择 |
