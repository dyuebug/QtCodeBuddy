# 第7章：主窗口

## 一、本章概述

### 1.1 学习目标

- 掌握 QMainWindow 的架构
- 学会创建菜单栏、工具栏、状态栏
- 理解停靠窗口的使用

### 1.2 核心知识点

| 知识点 | 重要程度 | 说明 |
|--------|----------|------|
| QMainWindow | ★★★★★ | 主窗口框架 |
| QMenuBar | ★★★★★ | 菜单栏 |
| QAction | ★★★★★ | 动作对象 |
| QToolBar | ★★★★☆ | 工具栏 |
| QDockWidget | ★★★★☆ | 停靠窗口 |
| 上下文菜单 | ★★★☆☆ | 右键菜单 |

---

## 二、QMainWindow 架构

```
┌─────────────────────────────────────┐
│           菜单栏 (MenuBar)           │
├─────────────────────────────────────┤
│           工具栏 (ToolBar)           │
├─────┬───────────────────────┬───────┤
│     │                       │       │
│停靠 │    中央控件            │ 停靠  │
│窗口 │  (CentralWidget)      │ 窗口  │
│     │                       │       │
├─────┴───────────────────────┴───────┤
│           状态栏 (StatusBar)         │
└─────────────────────────────────────┘
```

---

## 三、创建菜单栏

```cpp
// 创建菜单
QMenu *fileMenu = menuBar()->addMenu("文件(&F)");

// 创建动作
QAction *newAction = fileMenu->addAction("新建(&N)");
newAction->setShortcut(QKeySequence::New);
newAction->setStatusTip("创建新文件");

// 添加分隔线
fileMenu->addSeparator();

// 连接信号
connect(newAction, &QAction::triggered, this, &MainWindow::onNew);
```

---

## 四、QAction - 动作对象

### 4.1 创建动作

```cpp
QAction *newAction = new QAction("新建(&N)", this);
newAction->setShortcut(QKeySequence::New);
newAction->setStatusTip("创建新文件");
newAction->setCheckable(true);  // 可选中状态
```

### 4.2 连接动作

```cpp
connect(newAction, &QAction::triggered, this, &MainWindow::onNew);
```

---

## 五、创建工具栏

```cpp
QToolBar *toolBar = addToolBar("文件");
toolBar->addAction(newAction);
toolBar->addAction(openAction);
toolBar->addSeparator();
toolBar->addWidget(new QLabel("字体:"));
```

---

## 六、创建状态栏

```cpp
statusBar()->showMessage("就绪");
statusBar()->addPermanentWidget(new QLabel("行: 1"));
```

---

## 七、停靠窗口

```cpp
QDockWidget *dock = new QDockWidget("属性", this);
dock->setAllowedAreas(Qt::LeftDockWidgetArea | Qt::RightDockWidgetArea);
dock->setWidget(new QListWidget());
addDockWidget(Qt::LeftDockWidgetArea, dock);
```

---

## 八、中央控件

```cpp
QTextEdit *editor = new QTextEdit(this);
setCentralWidget(editor);
```

---

## 九、上下文菜单

```cpp
void MainWindow::contextMenuEvent(QContextMenuEvent *event)
{
    QMenu menu(this);
    menu.addAction(m_cutAction);
    menu.addAction(m_copyAction);
    menu.addAction(m_pasteAction);
    menu.addSeparator();
    menu.addAction(m_selectAllAction);

    menu.exec(event->globalPos());
}
```

---

## 十、本章小结

| 组件 | 作用 |
|------|------|
| QMenuBar | 菜单栏 |
| QAction | 动作对象 |
| QToolBar | 工具栏 |
| QStatusBar | 状态栏 |
| QDockWidget | 停靠窗口 |
| CentralWidget | 中央控件 |
| 上下文菜单 | 右键菜单 |
